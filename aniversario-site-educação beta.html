<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
  /* --- CORES E VARI√ÅVEIS --- */
  :root {
    --primary: #27ae60; --primary-dark: #1e8449; --accent: #eafff2;
    --highlight-today: #dcfce7; --white: #ffffff;
    --text-main: #2c3e50; --text-light: #95a5a6;
    --whatsapp-color: #25D366; --whatsapp-dark: #128C7E;
    --shadow: 0 10px 30px rgba(39, 174, 96, 0.15); --radius: 16px;
  }

  html, body { height: auto; min-height: 100%; }

  body {
    font-family: 'Poppins', sans-serif; margin: 0; padding: 10px;
    background: transparent; color: var(--text-main);
    box-sizing: border-box;
  }

  .widget-container {
    background: var(--white); border-radius: var(--radius);
    box-shadow: var(--shadow); padding: 25px; 
    width: 100%; max-width: 100%;
    margin: 0 auto; overflow: hidden; position: relative;
    display: flex; flex-direction: column;
    box-sizing: border-box;
  }

  /* --- CABE√áALHOS --- */
  .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 2px solid #f5f5f5; }
  .header-content { text-align: center; flex-grow: 1; padding: 0 10px; }
  .date-display { font-size: 1.4rem; font-weight: 700; color: var(--primary); text-transform: capitalize; line-height: 1.2; margin: 0; }
  .subtitle { font-size: 0.85rem; color: #7f8c8d; margin-top: 5px; font-weight: 500; }
  .nav-btn { background: var(--accent); color: var(--primary); border: none; width: 35px; height: 35px; border-radius: 10px; cursor: pointer; font-size: 1rem; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
  .nav-btn:hover { background: var(--primary); color: var(--white); transform: scale(1.05); }

  /* --- BUSCA --- */
  .search-container { margin-bottom: 20px; position: relative; width: 100%; box-sizing: border-box;}
  .search-input { width: 100%; padding: 10px 15px 10px 35px; border: 1px solid #e0e0e0; background: transparent; border-radius: 30px; font-family: 'Poppins', sans-serif; font-size: 0.9rem; color: var(--text-main); outline: none; box-sizing: border-box; transition: all 0.3s; }
  .search-input:focus { border-color: var(--primary); background: #fff; box-shadow: 0 0 0 2px var(--accent); }
  .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #ccc; pointer-events: none; font-size: 0.9rem; }

  /* --- IMPRESS√ÉO --- */
  .print-header { display: none; text-align: center; margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 20px; }
  .print-title { font-size: 20pt; font-weight: 800; color: #000; margin: 0; text-transform: uppercase;}
  .print-subtitle { font-size: 12pt; font-weight: 500; color: #333; margin: 5px 0 0 0; }

  /* --- HERO SECTION --- */
  #hero-section {
    display: none;
    /* Gradiente Fundo */
    background: radial-gradient(circle at top left, #27ae60, #1e8449);
    padding: 35px 20px; border-radius: var(--radius);
    margin-bottom: 30px; text-align: center;
    box-shadow: 0 10px 30px rgba(39, 174, 96, 0.25);
    animation: slideDown 0.5s ease-out; position: relative; overflow: hidden; 
    cursor: default; width: 100%; box-sizing: border-box;
  }
  .hero-content-wrapper { position: relative; z-index: 5; pointer-events: none; }
  .hero-content-wrapper * { pointer-events: auto; } 

  @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
  
  .hero-title { 
      font-size: 0.85rem; text-transform: uppercase; letter-spacing: 2px; 
      color: rgba(255,255,255,0.9); margin-bottom: 10px; font-weight: 600;
  }
  
  /* NOMES */
  .hero-names-container { display: flex; flex-direction: column; gap: 5px; margin: 10px 0 20px 0; }
  .hero-name-item { 
      font-size: 1.8rem; font-weight: 800; color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.15); line-height: 1.2;
  }
  
  /* CAIXA DE MENSAGEM (EFEITO VIDRO AQUI) */
  .hero-message-box { 
      background: rgba(255, 255, 255, 0.08); /* Super transparente */
      backdrop-filter: blur(8px); /* Desfoque do vidro */
      -webkit-backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px; 
      padding: 20px; 
      margin-top: 15px; 
      position: relative;
      z-index: 10; /* Fica acima dos emojis */
  }
  
  .hero-message-text { font-size: 0.95rem; font-weight: 400; line-height: 1.5; font-style: italic; margin-bottom: 10px; color: #fff; }
  
  .hero-signature { 
      font-size: 0.85rem; font-weight: 600; opacity: 0.9; margin-top: 5px; 
      border-top: 1px solid rgba(255,255,255,0.2); 
      padding-top: 8px; display: inline-block; color: #fff;
  }
  
  .hero-icon { font-size: 4rem; display: inline-block; margin-bottom: 5px; transition: transform 0.3s; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.1)); }
  #hero-section.active-party .hero-icon { animation: partyShake 0.8s infinite, intenseGlow 2s infinite alternate; }
  @keyframes partyShake { 0%, 100% { transform: rotate(0deg) scale(1.1); } 25% { transform: rotate(-10deg) scale(1.2); } 75% { transform: rotate(10deg) scale(1.2); } }
  @keyframes intenseGlow { from { filter: drop-shadow(0 0 5px gold); } to { filter: drop-shadow(0 0 25px gold); } }

  /* --- EFEITOS (Ativados por 3s) --- */
  .effects-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; overflow: hidden; }
  
  /* Emojis ficam atr√°s do vidro (z-index 1) */
  .floating-emoji { position: absolute; bottom: -60px; opacity: 0; user-select: none; z-index: 1; }
  
  #hero-section.active-party .floating-emoji { 
      animation-name: floatUpBurstNatural; 
      animation-duration: 3s; 
      animation-timing-function: ease-out; 
      animation-fill-mode: forwards; 
  }
  @keyframes floatUpBurstNatural {
      0% { transform: translate(0, 0) rotate(0deg) scale(0.5); opacity: 0; }
      10% { opacity: 0.8; transform: translate(calc(var(--drift) * 0.1), -50px) scale(1); }
      100% { transform: translate(var(--drift), -450px) rotate(var(--rot-end)) scale(1.3); opacity: 0; }
  }

  .confetti { position: absolute; top: 50%; left: 50%; width: 8px; height: 8px; border-radius: 3px; opacity: 0; background: gold; z-index: 20; }
  #hero-section.active-party .confetti { animation: fireworkRandom 3s ease-out forwards; }
  @keyframes fireworkRandom { 0% { transform: translate(0, 0) scale(0.5) rotate(0deg); opacity: 1; } 30% { transform: translate(var(--rand-x), var(--rand-y)) scale(1.5) rotate(var(--rand-rot)); opacity: 1; } 100% { transform: translate(var(--rand-x), calc(var(--rand-y) + 100px)) scale(0) rotate(calc(var(--rand-rot) + 180deg)); opacity: 0; } }

  /* --- LISTA --- */
  .birthday-list { list-style: none; padding: 0; margin: 0; max-height: none; overflow: visible; width: 100%; }
  .birthday-item { display: flex; align-items: center; padding: 12px; border-radius: 12px; margin-bottom: 8px; border: 1px solid transparent; transition: all 0.2s; position: relative; background-color: #fff; }
  .birthday-item:hover { background-color: #f9f9f9; border-color: #eee; }
  .is-today-item { background-color: var(--highlight-today) !important; border: 1px solid var(--primary) !important; }
  .is-today-item .person-name { color: var(--primary-dark) !important; font-weight: 800 !important; }
  .is-today-item .date-box { background-color: var(--primary) !important; color: var(--white) !important; }

  .date-box { display: flex; flex-direction: column; align-items: center; justify-content: center; background-color: #f3f4f6; color: var(--text-light); width: 55px; height: 55px; border-radius: 10px; margin-right: 15px; flex-shrink: 0; text-align: center; }
  .date-day { font-size: 1.2rem; font-weight: 700; line-height: 1; }
  .date-week { font-size: 0.65rem; text-transform: uppercase; font-weight: 600; margin-top: 2px; }
  .date-month { font-size: 0.6rem; text-transform: uppercase; font-weight: 600; margin-top: 1px; color: var(--white); opacity: 0.9;}
  .date-box:not(.is-today-item .date-box) .date-month { color: #888; }
  
  .person-info { flex-grow: 1; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 5px; }
  .person-name { font-size: 1rem; font-weight: 600; color: var(--text-main); margin-right: 5px; }

  /* --- BOT√ÉO WHATSAPP --- */
  .whatsapp-btn {
      background-color: var(--whatsapp-color); color: white; border: none; border-radius: 50px;
      padding: 6px 12px; font-size: 0.75rem; font-weight: 600; cursor: pointer;
      display: flex; align-items: center; gap: 5px; transition: all 0.3s ease;
      text-decoration: none; box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3); white-space: nowrap;
  }
  .whatsapp-btn:hover { background-color: var(--whatsapp-dark); transform: translateY(-2px); box-shadow: 0 6px 12px rgba(37, 211, 102, 0.5); }
  .wa-icon { font-size: 1.1rem; }

  /* --- RODAP√â --- */
  .footer-actions { margin-top: 20px; padding-top: 15px; border-top: 1px solid #f0f0f0; display: flex; justify-content: flex-start; }
  .print-btn { background: transparent; color: #95a5a6; border: 1px solid #e0e0e0; padding: 6px 12px; border-radius: 6px; font-family: 'Poppins', sans-serif; font-size: 0.75rem; font-weight: 500; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; transition: all 0.2s ease; }
  .print-btn:hover { background: #f5f5f5; color: #333; border-color: #ccc; }
  .status-msg { text-align: center; color: var(--text-light); margin: 30px 0; }
  .reset-btn { display: block; margin: 5px auto 0; background: none; border: 1px solid #ddd; padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; color: #888; cursor: pointer; }

  /* --- RESPONSIVIDADE MOBILE --- */
  @media (max-width: 480px) {
      body { padding: 5px; }
      .widget-container { padding: 15px; }
      .hero-name-item { font-size: 1.5rem; }
      .hero-icon { font-size: 3rem; }
      .date-box { width: 45px; height: 45px; margin-right: 10px; }
      .date-day { font-size: 1rem; }
      .person-name { font-size: 0.9rem; }
      .whatsapp-btn { padding: 4px 8px; font-size: 0.65rem; gap: 3px; }
      .wa-icon { font-size: 0.9rem; }
  }

  @media print {
      body { background: white; padding: 0; font-size: 12pt; }
      .widget-container { box-shadow: none; border: none; padding: 0; margin: 0; max-width: 100%; border-radius: 0; display: block; }
      .header, .nav-btn, .reset-btn, .footer-actions, #hero-section, .status-msg, .search-container, .whatsapp-btn { display: none !important; }
      .print-header { display: block !important; }
      .birthday-list { display: grid; grid-template-columns: 1fr 1fr; column-gap: 40px; max-height: none; overflow: visible; width: 100%; }
      .birthday-item { border: none; border-bottom: 1px solid #ddd; padding: 8px 0; break-inside: avoid; }
      .date-box { background-color: transparent !important; color: #000 !important; width: auto; height: auto; border-radius: 0; margin-right: 15px; text-align: left; flex-direction: row; align-items: baseline; gap: 5px; }
      .date-day { font-size: 14pt; color: #000; } .date-week { font-size: 10pt; color: #333; } .date-month { font-size: 10pt; color: #333; margin-left: 5px; display: inline-block !important; }
      .person-name { font-size: 12pt; color: #000; font-weight: 500; }
      .is-today-item { background-color: #f5f5f5 !important; border: 1px solid #ccc !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  }
</style>
</head>
<body>

<div class="widget-container">
  
  <div class="header">
    <button class="nav-btn no-print" onclick="changeMonth(-1)">&#10094;</button>
    <div class="header-content">
      <h2 id="month-display" class="date-display">Carregando...</h2>
      <div class="subtitle">Secretaria Municipal da Educa√ß√£o de Orindi√∫va</div>
      <button id="btn-today" class="reset-btn no-print" style="display:none;" onclick="resetToToday()">Voltar para Hoje</button>
    </div>
    <button class="nav-btn no-print" onclick="changeMonth(1)">&#10095;</button>
  </div>

  <div class="search-container">
      <span class="search-icon">üîç</span>
      <input type="text" id="search-input" class="search-input" placeholder="" onkeyup="handleSearch()">
  </div>

  <div class="print-header">
      <h1 id="print-title" class="print-title">ANIVERSARIANTES</h1>
      <h2 class="print-subtitle">Secretaria Municipal da Educa√ß√£o de Orindi√∫va</h2>
  </div>

  <div id="hero-section">
    <div id="emoji-background" class="effects-container">
        <div class="confetti-pool">
            <div class="confetti"></div><div class="confetti"></div><div class="confetti"></div><div class="confetti"></div><div class="confetti"></div>
            <div class="confetti"></div><div class="confetti"></div><div class="confetti"></div><div class="confetti"></div><div class="confetti"></div>
            <div class="confetti"></div><div class="confetti"></div><div class="confetti"></div><div class="confetti"></div><div class="confetti"></div>
            <div class="confetti"></div><div class="confetti"></div><div class="confetti"></div><div class="confetti"></div><div class="confetti"></div>
        </div>
    </div>
    <div class="hero-content-wrapper">
        <span class="hero-icon">üéÇ</span>
        <div id="hero-title" class="hero-title">Aniversariante do Dia!</div>
        <div id="hero-names" class="hero-names-container"></div>
        
        <div class="hero-message-box">
            <div id="hero-message-text" class="hero-message-text"></div>
            <div class="hero-signature">Com carinho,<br>Secretaria Municipal de Educa√ß√£o de Orindi√∫va</div>
        </div>
    </div>
  </div>
  
  <div id="list-container">
    <div class="status-msg">Procurando festas...</div>
  </div>

  <div class="footer-actions">
      <button class="print-btn" onclick="window.print()">üñ®Ô∏è Imprimir</button>
  </div>

</div>

<script>
  // --- CONFIGURA√á√ïES ---
  const CALENDAR_ID = 'c_aac01d0cbc7c5ed5147d0b02239e95cc283095daff716e32cb79d53bd184370b@group.calendar.google.com'; 
  const API_KEY = 'AIzaSyDuCPt6S-mF33IGaMnYtiYLJlDjaXJG4wA'; 
  // --------------------

  const messagesSingular = [
      "Feliz Anivers√°rio! üéâ Desejamos a voc√™ um dia cheio de alegria e realiza√ß√µes. Sua dedica√ß√£o √† educa√ß√£o √© admir√°vel e inspiradora. Que este novo ano de vida lhe traga muito sucesso, alegrias e paz. ‚ú®",
      "Hoje √© dia de celebrar a vida de quem dedica a sua ao ensino. Parab√©ns! ü•≥ Que seu caminho continue sendo iluminado e cheio de conquistas. üåü",
      "Parab√©ns! üéÇ Que a felicidade seja sua companheira di√°ria e que seu trabalho continue inspirando todos ao seu redor. Felicidades! üëè",
      "Desejamos um anivers√°rio repleto de sorrisos e um novo ciclo de vida cheio de prosperidade. Obrigado por fazer parte da nossa equipe! üíö",
      "Feliz vida! üéà Que voc√™ tenha um ano incr√≠vel, com sa√∫de, paz e muitas realiza√ß√µes pessoais e profissionais. üôå",
      "Hoje celebramos voc√™! üéÅ Que seu anivers√°rio seja t√£o especial quanto a sua dedica√ß√£o em fazer a diferen√ßa na educa√ß√£o do nosso munic√≠pio. ü•∞",
      "Parab√©ns pelo seu dia! üéâ Que a alegria de hoje se estenda por todo o seu novo ano. Muita sa√∫de e sucesso! üçæ",
      "Feliz Anivers√°rio! üç∞ Que a vida continue lhe presenteando com bons momentos e que sua jornada na educa√ß√£o continue gerando belos frutos. üå≥",
      "Um feliz anivers√°rio cheio de luz! ‚ú® Agradecemos por todo empenho e carinho dedicados ao nosso trabalho. Tudo de bom! ‚ù§Ô∏è",
      "Viva! ü•≥ Hoje o dia √© todo seu. Desejamos que voc√™ realize todos os seus sonhos e continue sendo essa pessoa especial para nossa equipe. üéà"
  ];

  const messagesPlural = [
      "Feliz Anivers√°rio! üéâ Desejamos a voc√™s um dia cheio de alegria e realiza√ß√µes. A dedica√ß√£o de voc√™s √† educa√ß√£o √© admir√°vel e inspiradora. Que este novo ano de vida lhes traga muito sucesso, alegrias e paz. ‚ú®",
      "Hoje √© dia de celebrar a vida de quem dedica a sua ao ensino. Parab√©ns! ü•≥ Que o caminho de voc√™s continue sendo iluminado e cheio de conquistas. üåü",
      "Parab√©ns! üéÇ Que a felicidade seja a companheira di√°ria de voc√™s e que o trabalho de cada um continue inspirando todos ao redor. Felicidades! üëè",
      "Desejamos um anivers√°rio repleto de sorrisos e um novo ciclo de vida cheio de prosperidade. Obrigado por fazerem parte da nossa equipe! üíö",
      "Feliz vida! üéà Que voc√™s tenham um ano incr√≠vel, com sa√∫de, paz e muitas realiza√ß√µes pessoais e profissionais. üôå",
      "Hoje celebramos voc√™s! üéÅ Que o anivers√°rio seja t√£o especial quanto a dedica√ß√£o de voc√™s em fazer a diferen√ßa na educa√ß√£o do nosso munic√≠pio. ü•∞",
      "Parab√©ns pelo dia de voc√™s! üéâ Que a alegria de hoje se estenda por todo o novo ano. Muita sa√∫de e sucesso! üçæ",
      "Feliz Anivers√°rio! üç∞ Que a vida continue presenteando voc√™s com bons momentos e que a jornada na educa√ß√£o continue gerando belos frutos. üå≥",
      "Um feliz anivers√°rio cheio de luz! ‚ú® Agradecemos por todo empenho e carinho dedicados ao nosso trabalho. Tudo de bom para voc√™s! ‚ù§Ô∏è",
      "Viva! ü•≥ Hoje o dia √© todo de voc√™s. Desejamos que realizem todos os seus sonhos e continuem sendo essas pessoas especiais para nossa equipe. üéà"
  ];

  let currentDate = new Date();
  let searchTimer = null;
  let isSearchMode = false;
  let animationTimeout = null; 

  const listContainer = document.getElementById('list-container');
  const heroSection = document.getElementById('hero-section');
  const heroNames = document.getElementById('hero-names');
  const heroMessageText = document.getElementById('hero-message-text');
  const heroTitle = document.getElementById('hero-title');
  const btnToday = document.getElementById('btn-today');
  const printTitle = document.getElementById('print-title');

  function init() {
    renderHeader();
    fetchEvents();
    prepareEmojis(); 
    setupInteraction(); 
  }

  function getRandomMessage(isPlural = false) {
      const sourceArray = isPlural ? messagesPlural : messagesSingular;
      const randomIndex = Math.floor(Math.random() * sourceArray.length);
      return sourceArray[randomIndex];
  }

  // --- FUN√á√ÉO DE COMPARTILHAMENTO (API WHATSAPP) ---
  function shareWhatsapp(fullName) {
      const firstName = fullName.split(' ')[0]; 
      const phrase = getRandomMessage(false);
      const signature = "Com carinho,\nSecretaria Municipal de Educa√ß√£o de Orindi√∫va";
      
      const text = "üéâ Parab√©ns " + firstName + "! üéÇ\n\n" + phrase + "\n\n" + signature + " üéàüéÅ";
      
      const url = "https://api.whatsapp.com/send?text=" + encodeURIComponent(text);
      window.open(url, '_blank');
  }

  function prepareEmojis() {
      const container = document.getElementById('emoji-background');
      const emojis = ['üéâ', 'üéÅ', 'üéÇ', 'ü•≥', 'üçæ', '‚ú®', 'üéà', 'üëè', 'üç∞', '‚ù§Ô∏è'];
      const numEmojis = 30;

      for (let i = 0; i < numEmojis; i++) {
          const el = document.createElement('span');
          el.classList.add('floating-emoji');
          el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
          const left = Math.random() * 100;
          const size = (Math.random() * 1.5) + 1.2;
          const delay = Math.random() * 0.5; 
          const drift = (Math.random() * 200 - 100) + 'px';
          const rotEnd = (Math.random() * 720 - 360) + 'deg';

          el.style.left = `${left}%`;
          el.style.fontSize = `${size}rem`;
          el.style.animationDelay = `${delay}s`;
          el.style.setProperty('--drift', drift);
          el.style.setProperty('--rot-end', rotEnd);
          container.appendChild(el);
      }
  }

  function setupInteraction() {
      const confettiElements = document.querySelectorAll('.confetti');
      const colors = ['#e74c3c', '#f1c40f', '#3498db', '#9b59b6', '#2ecc71', '#e67e22', '#ffffff'];
      const heroArea = document.getElementById('hero-section');

      heroArea.addEventListener('mouseenter', () => {
          heroArea.classList.add('active-party');
          confettiElements.forEach(el => {
              const randX = Math.floor(Math.random() * 400) - 200; 
              const randY = Math.floor(Math.random() * 200) - 300;
              const randRot = Math.floor(Math.random() * 360);
              const randomColor = colors[Math.floor(Math.random() * colors.length)];
              el.style.setProperty('--rand-x', randX + 'px');
              el.style.setProperty('--rand-y', randY + 'px');
              el.style.setProperty('--rand-rot', randRot + 'deg');
              el.style.backgroundColor = randomColor;
          });
          if (animationTimeout) clearTimeout(animationTimeout);
          animationTimeout = setTimeout(() => {
              heroArea.classList.remove('active-party');
          }, 3000);
      });
  }

  function renderHeader() {
    if (isSearchMode) {
        document.getElementById('month-display').innerText = "Resultados da Busca";
        printTitle.innerText = "RESULTADOS DA BUSCA";
        btnToday.style.display = 'block';
        return;
    }
    const optionsScreen = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
    let fullDate = currentDate.toLocaleDateString('pt-BR', optionsScreen);
    fullDate = fullDate.charAt(0).toUpperCase() + fullDate.slice(1);
    document.getElementById('month-display').innerText = fullDate;

    const optionsPrint = { month: 'long', year: 'numeric' };
    let printDate = currentDate.toLocaleDateString('pt-BR', optionsPrint);
    printTitle.innerText = "ANIVERSARIANTES DE " + printDate.toUpperCase();

    const now = new Date();
    if (currentDate.getMonth() !== now.getMonth() || currentDate.getFullYear() !== now.getFullYear()) {
      btnToday.style.display = 'block';
    } else {
      btnToday.style.display = 'none';
    }
  }

  function changeMonth(step) {
    if (isSearchMode) {
        document.getElementById('search-input').value = '';
        isSearchMode = false;
        currentDate = new Date();
    }
    currentDate.setDate(1); 
    currentDate.setMonth(currentDate.getMonth() + step);
    renderHeader();
    fetchEvents();
  }

  function resetToToday() {
    document.getElementById('search-input').value = '';
    isSearchMode = false;
    currentDate = new Date();
    renderHeader();
    fetchEvents();
  }

  function handleSearch() {
      clearTimeout(searchTimer);
      const query = document.getElementById('search-input').value.trim();
      searchTimer = setTimeout(() => {
          if (query.length > 0) {
              isSearchMode = true;
              fetchAnnualEvents(query);
          } else {
              isSearchMode = false;
              resetToToday();
          }
      }, 500);
  }

  async function fetchAnnualEvents(query) {
      listContainer.innerHTML = '<div class="status-msg">Buscando em todo o ano...</div>';
      heroSection.style.display = 'none';
      renderHeader();
      const year = currentDate.getFullYear();
      const timeMin = new Date(year, 0, 1).toISOString();
      const timeMax = new Date(year, 11, 31, 23, 59, 59).toISOString();
      const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(CALENDAR_ID)}/events?key=${API_KEY}&timeMin=${timeMin}&timeMax=${timeMax}&singleEvents=true&orderBy=startTime&maxResults=2500`;

      try {
        const response = await fetch(url);
        const data = await response.json();
        const filteredEvents = data.items.filter(event => 
            event.summary && event.summary.toLowerCase().includes(query.toLowerCase())
        );
        renderList(filteredEvents, true);
      } catch (error) {
        listContainer.innerHTML = `<div class="status-msg">Erro na busca.</div>`;
      }
  }

  async function fetchEvents() {
    listContainer.innerHTML = '<div class="status-msg">Carregando lista...</div>';
    heroSection.style.display = 'none';
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const timeMin = new Date(year, month, 1).toISOString();
    const timeMax = new Date(year, month + 1, 0, 23, 59, 59).toISOString();
    const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(CALENDAR_ID)}/events?key=${API_KEY}&timeMin=${timeMin}&timeMax=${timeMax}&singleEvents=true&orderBy=startTime`;

    try {
      const response = await fetch(url);
      const data = await response.json();
      renderList(data.items, false);
    } catch (error) {
      console.error(error);
      listContainer.innerHTML = `<div class="status-msg" style="color:#e74c3c">Erro na conex√£o.</div>`;
    }
  }

  function renderList(events, showMonthName) {
    events.sort((a, b) => {
        const dateAStr = a.start.date || a.start.dateTime;
        const dateBStr = b.start.date || b.start.dateTime;
        return dateAStr.localeCompare(dateBStr);
    });

    listContainer.innerHTML = '';
    let birthdaysToday = [];
    let listItems = [];
    const today = new Date();
    const isCurrentMonthView = !isSearchMode && (today.getMonth() === currentDate.getMonth() && today.getFullYear() === currentDate.getFullYear());

    if (!events || events.length === 0) {
      listContainer.innerHTML = '<div class="status-msg">Nenhum resultado encontrado.</div>';
      return;
    }

    events.forEach(event => {
      let eventDateStr = event.start.date || event.start.dateTime;
      if (!eventDateStr) return;
      let eventDate = new Date(eventDateStr);
      if(event.start.date) { eventDate = new Date(eventDate.getUTCFullYear(), eventDate.getUTCMonth(), eventDate.getUTCDate()); }

      const day = eventDate.getDate();
      const monthShort = eventDate.toLocaleDateString('pt-BR', { month: 'short' }).replace('.', '');
      const weekDay = eventDate.toLocaleDateString('pt-BR', { weekday: 'short' }).replace('.', '');
      const isActuallyToday = day === today.getDate() && eventDate.getMonth() === today.getMonth();
      const isTodayHighlight = isActuallyToday;

      if (isActuallyToday && !isSearchMode) { birthdaysToday.push(event.summary); }
      
      listItems.push({
        name: event.summary, day: day < 10 ? '0' + day : day, week: weekDay, month: monthShort, isToday: isTodayHighlight
      });
    });

    if (birthdaysToday.length > 0 && !isSearchMode) {
      heroNames.innerHTML = birthdaysToday.map(name => `<div class="hero-name-item">${name}</div>`).join('');
      const isPlural = birthdaysToday.length > 1;
      heroMessageText.innerText = getRandomMessage(isPlural);
      heroTitle.innerText = isPlural ? "Aniversariantes do Dia!" : "Aniversariante do Dia!";
      heroSection.style.display = 'block';
    } else {
      heroSection.style.display = 'none';
    }

    const ul = document.createElement('ul');
    ul.className = 'birthday-list';
    listItems.forEach(person => {
      const li = document.createElement('li');
      li.className = `birthday-item ${person.isToday ? 'is-today-item' : ''}`;
      
      let dateContent = `<span class="date-day">${person.day}</span><span class="date-week">${person.week}</span>`;
      if (showMonthName) { dateContent += `<span class="date-month">${person.month}</span>`; }

      let whatsappButtonHTML = '';
      if (person.isToday) {
          const safeName = person.name.replace(/'/g, "\\'");
          whatsappButtonHTML = `
            <button class="whatsapp-btn" onclick="shareWhatsapp('${safeName}')" title="Enviar Cart√£o">
                <span class="wa-icon">üí¨</span> Enviar Parab√©ns
            </button>
          `;
      }

      li.innerHTML = `
        <div class="date-box">${dateContent}</div>
        <div class="person-info">
            <span class="person-name">${person.name}</span>
            ${whatsappButtonHTML}
        </div>
      `;
      ul.appendChild(li);
    });
    listContainer.appendChild(ul);
  }

  init();
</script>

</body>
</html>